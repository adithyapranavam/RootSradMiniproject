
<%- include('../partials/userheader.ejs')%>
<%- include('../layouts.ejs')%>

<main class="main">
     <div class="page-header text-center" style="background-image: url('assets/images/page-header-bg.jpg')">
        <div class="container">
            <h1 class="page-title">My Account</h1>
        </div>
    </div> 
     <nav aria-label="breadcrumb" class="breadcrumb-nav mb-3">
        <div class="container">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/">Home</a></li>
                <li class="breadcrumb-item"><a href="/shop">Shop</a></li>
                <li class="breadcrumb-item active" aria-current="page">My Account</li>
            </ol>
        </div>
    </nav> 
    <div class="page-content">
        <div class="dashboard">
            <div class="container">
                <div class="row">
                    <aside class="col-md-4 col-lg-3">
                        <ul class="nav nav-dashboard flex-column mb-3 mb-md-0" role="tablist">
                            <li class="nav-item">
                                <a class="nav-link active" id="tab-dashboard-link" data-toggle="tab" href="#tab-dashboard" role="tab" aria-controls="tab-dashboard" aria-selected="true">
                                    <i class="bi bi-person-circle"></i> profile</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" id="tab-orders-link" data-toggle="tab" 
                                href="#tab-orders" role="tab" aria-controls="tab-orders" aria-selected="false">
                                    <i class="bi bi-truck"></i> Orders</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" id="tab-address-link" data-toggle="tab" href="#tab-address" role="tab" aria-controls="tab-address" aria-selected="false"><i class="bi bi-journal-text"></i> Adresses</a>
                            </li>
                           
                           
                        </ul>
                    </aside>

                    <div class="col-md-8 col-lg-9">
                        <div class="tab-content">
                            <div class="tab-pane fade show active" id="tab-dashboard" role="tabpanel" aria-labelledby="tab-dashboard-link">
                                <p>Hello <span class="font-weight-normal text-dark"><%=name%></span>
                                <br>
                                From your account dashboard you can view your <a href="#tab-orders" class="tab-trigger-link link-underline">recent orders</a>, manage your <a href="#tab-address" class="tab-trigger-link-underline">shipping and billing addresses</a>.</p>
                            </div>


                                      <!-- modal edit profile -->
                            
                            <div class="modal fade" id="myModal" tabindex="-1" role="dialog"
                                aria-labelledby="exampleModalLabel" aria-hidden="true">
                                <div class="modal-dialog" role="document">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h5 class="modal-title" id="exampleModalLabel">Edit profile</h5>
                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                <span aria-hidden="true">&times;</span>
                                            </button>
                                        </div>
                                        <div class="modal-body">
                                            <div class="form-group p-5">
                                                <label for="recipient-name" class="col-form-label">Name</label>
                                                <input type="text" value="" class="form-control border border-5" id="recipient-name" name="name" required>
                                                <span id="nameError" class="text-danger"></span>
                                            </div>
                                            <div class="form-group p-5">
                                                <label for="recipient-email" class="col-form-label">Email</label>
                                                <input type="email" value="" class="form-control border border-5" id="recipient-email" name="email" required>
                                                <span id="emailError" class="text-danger"></span>
                                            </div>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary" id="modalClose" data-dismiss="modal">Close</button>
                                            <button onclick="edit()" type="button" class="btn btn-primary" id="updateBtn">Update</button>
                                        </div>
                                       
                                    </div>
                                </div>
                            </div>

                            <div class="tab-pane fade" id="tab-orders" role="tabpanel" aria-labelledby="tab-orders-link">
                                <% if(product.length === 0){ %>
                                    <div class="d-flex align-items-center justify-content-center">
                                        <lottie-player
                                            src="https://assets10.lottiefiles.com/packages/lf20_3VDN1k.json"
                                            background="transparent" speed="5"
                                            style="width: 300px; height: 300px; opacity: 80%;" loop autoplay>
                                        </lottie-player>
                                        
                                    </div>
                                    <% } else { %> 
                                <table class="table">
                                    <thead>
                                      <tr>
                                        <th> Name </th>
                                        <th > Image  </th>
                                        <th style="text-align: center;"> Quantity </th>
                                        <th style="text-align: center;"> Amount </th>
                                        <th style="text-align: center;">Status</th>
                                        <th style="text-align: center;">Show Details</th>
                                      </tr>
                                    </thead>
                                    <tbody>
            
                                      <% for(var i=0;i<orders.length;i++){%>
                                        <tr style="border: solid 5px;">
                                        <% for(var j=0 ;j<orders[i].products.item.length ;j++) {%>
                                          <tr >
                                          <% for(var k=0;k<product.length;k++) {%>
                                            
                                           <% if(product[k]._id.toString()  ==  orders[i].products.item[j].productId.toString()){ %>  
                                              <td ><%= product[k].name %></td>
                                              <td><img src="/productImages/<%= product[k].image[0] %>" alt="" style="width: 50px; height: 50px;" ></td>
                                              
                                              <td style="text-align: center;"><%= orders[i].products.item[j].qty %></td>
                                              
                                              <% if(j==0){ %>
                                                <td style="text-align: center;"><%= orders[i].products.totalPrice %></td>
                                                <% }%>
                                              
                                                <% if(j==0){ %>
                                              <td style="text-align: center;"><%= orders[i].status %></td>
                                              <% }%>
            
                                              <% if(j==0){ %>
                                              <td style="text-align: center;">
                                                <a href="/orderStatus?id=<%= orders[i]._id %>" >Show Details</a>  
            
                                              </td>
                                              <% }%>
                                            <% }%>
                                           
                                          <%}%>
                                          
                                        </tr>
                                        
                                        <%}%>
                                        
                                      </tr>
                                    <%}%>
            
                                    </tbody>
                                  </table>
                                  <% } %>
                            </div>
                <div class="tab-pane fade" id="tab-address" role="tabpanel"
                            aria-labelledby="tab-address-link">
                        <h3 class="card-title ">Shipping Address </h3>
                            <br>
                      <div class="m-3">
                                <a class="btn btn-outline-primary p-3" data-toggle="modal"
                                    data-target="#exampleModal">Add<i class="icon-edit  "></i></a>

                      </div>
                        <div class="row">
                            
                            <div class="col-lg-12 " id="address-reload">
                                <% userData.address.forEach((data,index)=>{%>
                                <div class="col-lg-12 ">
                                    
                                    <div class="card card-dashboard  border border-3 rounded">

                                        <div class="card-body">

                                             <p>
                                                <%=data.fullname%><br>
                                                <%=data.houseName%><br>
                                                <%=data.country%><br>
                                                <%=data.city%><br>
                                                <%=data.state%><br>
                                                <%=data.mobile%><br>
                                                <%=data.pin%><br>
                                                <%=data.email%><br>
                                                <a  href="/editAddress?id=<%=data._id%>">Edit Address<i class="icon-edit"></i></a>
                                            </p> 
                                            <a href="/deleteAddress?id=<%=data._id%>"><i
                                                class="bi bi-trash3-fill text-primary h5"></i>
                                            </a>
                                        </div>
                                    </div>
                                </div>   
                            </div> 
                            <% }); %>
                        </div>
                </div>
              
                
                            <!-- address modal -->
                        <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
                            aria-hidden="true">
                            <div class="modal-dialog" role="document">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="exampleModalLabel">Billing address</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close" id="closeBtn">
                                            <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>
                                    <div class="modal-body">
                                        <form action="/AddressUpdate" method="post"onsubmit="return validateForm()">
                                            <div class="row p-5">
                                                <div class="col-lg-9">
                    
                                                    <div class="row">
                                                        <div class="col-sm-6">
                                                            <label>Full Name *</label>
                                                            <input type="text" class="form-control" name="fullname" id="fullname">
                                                            <span class="error-message text-danger" id="fullname-error"></span>
                                                        </div>
                                                    </div>
                    
                                                    <label>Country *</label>
                                                    <input type="text" class="form-control" name="country" id="country">
                                                    <span class="error-message text-danger" id="country-error"></span>
                    
                                                    <label>Street address *</label>
                                                    <input type="text" class="form-control" placeholder="House number and Street name"
                                                        name="houseName" id="houseName">
                                                    <span class="error-message text-danger" id="housename-error"></span>
                    
                                                    <div class="row">
                                                        <div class="col-sm-6">
                                                            <label>Town *</label>
                                                            <input type="text" class="form-control" name="city" id="city">
                                                            <span class="error-message text-danger" id="city-error"></span>
                                                        </div>
                    
                                                        <div class="col-sm-6">
                                                            <label>State *</label>
                                                            <input type="text" class="form-control" name="state" id="state">
                                                            <span class="error-message text-danger" id="state-error"></span>
                                                        </div>
                                                    </div>
                    
                                                    <div class="row">
                                                        <div class="col-sm-6">
                                                            <label>Postcode *</label>
                                                            <input type="text" class="form-control" name="pin" id="pin">
                                                            <span class="error-message text-danger" id="pin-error"></span>
                                                        </div>
                    
                                                        <div class="col-sm-6">
                                                            <label>Phone *</label>
                                                            <input type="tel" class="form-control" name="mobile" id="mobile">
                                                            <span class="error-message text-danger" id="mobile-error"></span>
                                                        </div>
                                                    </div>
                    
                                                    <label>Email address *</label>
                                                    <input type="email" class="form-control" name="email" id="email">
                                                    <span class="error-message text-danger" id="email-error"></span>
                                                </div>
                    
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                                <button type="submit" class="btn btn-primary">Add</button>
                                        </form>
                                    </div>
                    
                                </div>
                            </div>
                        </div>
                    </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>
<script src="./js/validation.js"></script>

<%- include('../partials/userfooter.ejs') %>